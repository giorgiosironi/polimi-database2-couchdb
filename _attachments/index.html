<!DOCTYPE html>
<html>
  <head>
    <title>My New CouchApp</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
  </head>
  <body>
    <div id="account"></div>

    <h1>Generated CouchApp</h1>

    <div id="profile"></div>
    <div id="items"></div>
    <div id="tagcloud"></div>
    <div id="sales_by_period"></div>

    <div id="sidebar">
      <p>Edit welcome message.</p>
      <p>Ideas: You could easily turn this into a photo sharing app, or a grocery list, or a chat room.</p>
    </div>
  </body>
  <script src="vendor/couchapp/loader.js"></script>
  <script type="text/javascript" charset="utf-8">
    $.couch.app(function(app) {
      $("#account").evently("account", app);
      $("#profile").evently("profile", app);
      $.evently.connect("#account","#profile", ["loggedIn","loggedOut"]);
    //  $("#items").evently("items", app);
    });
    db = $.couch.db('marketing');

    function loadAllMaterial() {  
        $("div#items").empty();  
        db.view("marketing/all", {  
         success: function(data) {  
          for (i in data.rows) {  
           id = data.rows[i].id;  
           item = data.rows[i].value;  
           html = '<div class="document">' +  
            '<span class="name">' + item.name + '</span>' +
            '<span class="tags">';
            for (j in item.tags) {
                tag = item.tags[j];
                html += '<span class="tag">' + tag + '</span>';
            }
            html +=
    //        '<a href="#" class="edit">edit</a> '+  
    //        '<a href="#" class="delete">delete</a> '+  
            '</span></div>';  
           $("div#items").append(html);  
          }  
        }});  
       }  

       function loadTagCloud()
       {
        $("div#tagcloud").empty();  
        db.view("marketing/tagcloud", {  
            'group_level' : 1,
         success: function(data) {  
          for (i in data.rows) {  
           tag = data.rows[i].key;
           fontsize = data.rows[i].value * 20;  
           html = '<span style="font-size: ' + fontsize + 'px;">' + tag + '</span>';
           $("div#tagcloud").append(html);  
            }  
          }
        });  

       }

       function loadSalesByPeriod(group_level)
       {
        $("div#sales_by_period").empty();  
        db.view("marketing/sales_by_period", {  
            'group_level' : group_level,
         success: function(data) {  
          for (i in data.rows) {  
           period = data.rows[i].key;
           number = data.rows[i].value;
           html = '<tr>' + 
           '<td>' + period + '</td>' +
           '<td>' + number + '</td>' + 
           '</tr>';
           $("div#sales_by_period").append(html);  
            }  
          },
        });  
       }

    $(function() {
        loadAllMaterial();
        loadTagCloud();
        loadSalesByPeriod(1);
    });
  </script>
</html>
